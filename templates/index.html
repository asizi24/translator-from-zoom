<!DOCTYPE html>
<html lang="he" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>תמלול הקלטות זום</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Rubik', sans-serif;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .drag-over {
            border-color: #667eea !important;
            background-color: #f0f4ff !important;
        }
    </style>
</head>

<body class="bg-gradient-to-br from-blue-50 to-purple-50 min-h-screen flex items-center justify-center p-4">

    <div class="w-full max-w-3xl">

        <!-- Main Card -->
        <div class="bg-white rounded-2xl shadow-2xl overflow-hidden mb-6">

            <!-- Header -->
            <div class="gradient-bg p-8 text-white text-center">
                <h1 class="text-4xl font-bold mb-2">🎙️ תמלול הקלטות זום</h1>
                <p class="text-purple-100">הכנס קישור או העלה קובץ, ותקבל תמלול מלא בעברית</p>
            </div>

            <!-- Content -->
            <div class="p-8">

                <!-- Input Form -->
                <div id="input-section" class="mb-8">
                    <!-- Tabs -->
                    <div class="flex border-b border-gray-200 mb-6">
                        <button onclick="switchTab('url')" id="url-tab"
                            class="flex-1 py-3 px-4 text-center font-medium border-b-2 border-purple-600 text-purple-600 transition">
                            🔗 קישור
                        </button>
                        <button onclick="switchTab('upload')" id="upload-tab"
                            class="flex-1 py-3 px-4 text-center font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700 transition">
                            📤 העלאת קובץ
                        </button>
                        <button onclick="switchTab('paste')" id="paste-tab"
                            class="flex-1 py-3 px-4 text-center font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700 transition">
                            📋 הדבקת טקסט
                        </button>
                    </div>

                    <!-- URL Tab Content -->
                    <div id="url-content" class="tab-content">
                        <label for="zoom-url" class="block text-gray-700 text-sm font-bold mb-2">
                            📎 קישור להקלטת Zoom
                        </label>
                        <div class="flex gap-2">
                            <div class="flex-1 relative">
                                <input type="text" id="zoom-url" placeholder="https://zoom.us/rec/share/..."
                                    class="w-full appearance-none border-2 border-gray-200 rounded-lg py-3 px-4 pl-20 text-gray-700 leading-tight focus:outline-none focus:border-purple-500 transition">
                                <button onclick="pasteFromClipboard()"
                                    class="absolute left-2 top-1/2 transform -translate-y-1/2 bg-gray-100 hover:bg-gray-200 text-gray-700 text-sm px-3 py-1 rounded transition">
                                    📋 הדבק
                                </button>
                            </div>
                            <button onclick="startProcessURL()" id="start-btn"
                                class="bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-bold py-3 px-8 rounded-lg focus:outline-none focus:shadow-outline transition duration-300 transform hover:scale-105">
                                התחל תמלול
                            </button>
                        </div>
                    </div>

                    <!-- Upload Tab Content -->
                    <div id="upload-content" class="tab-content hidden">
                        <label class="block text-gray-700 text-sm font-bold mb-2">
                            📤 העלה קובץ וידאו
                        </label>

                        <!-- Drag & Drop Zone -->
                        <div id="drop-zone"
                            class="border-3 border-dashed border-gray-300 rounded-lg p-8 text-center cursor-pointer hover:border-purple-400 transition"
                            ondrop="handleDrop(event)" ondragover="handleDragOver(event)"
                            ondragleave="handleDragLeave(event)"
                            onclick="document.getElementById('file-input').click()">

                            <svg class="mx-auto h-16 w-16 text-gray-400 mb-4" fill="none" stroke="currentColor"
                                viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12">
                                </path>
                            </svg>

                            <p class="text-gray-600 mb-2">גרור קובץ לכאן או לחץ לבחירה</p>
                            <p class="text-sm text-gray-400">MP4, AVI, MOV, MKV (עד 500MB)</p>

                            <input type="file" id="file-input" class="hidden"
                                accept="video/*,.mp4,.avi,.mov,.mkv,.webm,.flv" onchange="handleFileSelect(event)">
                        </div>

                        <!-- Selected File Display -->
                        <div id="selected-file"
                            class="hidden mt-4 p-4 bg-blue-50 rounded-lg flex justify-between items-center">
                            <div class="flex items-center gap-3">
                                <span class="text-2xl">🎬</span>
                                <div>
                                    <p class="font-medium text-gray-900" id="file-name"></p>
                                    <p class="text-sm text-gray-500" id="file-size"></p>
                                </div>
                            </div>
                            <button onclick="clearFileSelection()" class="text-red-500 hover:text-red-700 font-bold">
                                ✕
                            </button>
                        </div>

                        <!-- Upload Button -->
                        <button onclick="uploadFile()" id="upload-btn" disabled
                            class="w-full mt-4 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-bold py-3 px-8 rounded-lg focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed transition duration-300">
                            התחל תמלול מהקובץ
                        </button>
                    </div>

                    <!-- Paste Tab Content -->
                    <div id="paste-content" class="tab-content hidden">
                        <label class="block text-gray-700 text-sm font-bold mb-2">
                            📋 הדבק או העלה תמלול קיים
                        </label>
                        <p class="text-gray-500 text-sm mb-3">יש לך תמלול מוכן? הדבק אותו כאן או העלה קובץ TXT ועבור
                            ישירות לצ'אט AI</p>

                        <!-- File Upload for Transcript -->
                        <div class="mb-4 p-4 bg-purple-50 rounded-lg border-2 border-dashed border-purple-200 hover:border-purple-400 transition cursor-pointer"
                            onclick="document.getElementById('transcript-file-input').click()">
                            <div class="flex items-center justify-center gap-3">
                                <span class="text-2xl">📄</span>
                                <div>
                                    <p class="text-purple-700 font-medium">העלה קובץ תמלול (TXT)</p>
                                    <p class="text-purple-500 text-sm" id="transcript-file-name">לחץ לבחירת קובץ</p>
                                </div>
                            </div>
                            <input type="file" id="transcript-file-input" class="hidden" accept=".txt"
                                onchange="handleTranscriptFile(event)">
                        </div>

                        <div class="text-center text-gray-400 text-sm mb-3">— או —</div>

                        <textarea id="paste-text" rows="6" placeholder="הדבק כאן את התמלול שלך..."
                            class="w-full border-2 border-gray-200 rounded-lg py-3 px-4 text-gray-700 leading-relaxed focus:outline-none focus:border-purple-500 transition resize-none"></textarea>

                        <div class="flex gap-2 mt-4">
                            <button onclick="clearPasteText()"
                                class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-3 px-6 rounded-lg transition">
                                🗑️ ניקוי
                            </button>
                            <button onclick="submitPastedText()" id="paste-submit-btn"
                                class="flex-1 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-bold py-3 px-8 rounded-lg focus:outline-none transition duration-300 transform hover:scale-105">
                                🚀 המשך לצ'אט AI
                            </button>
                        </div>
                    </div>

                    <p id="error-msg" class="text-red-500 text-sm mt-2 hidden"></p>
                </div>

                <!-- Progress Section (Hidden by default) -->
                <div id="progress-section" class="hidden">
                    <!-- SVG Morphing Loader -->
                    <div id="morph-svg-container" class="flex justify-center mb-6">
                        <svg width="100" height="60" viewBox="0 0 100 60" class="transition-all duration-500">
                            <!-- SVG content will be dynamically injected by GSAP -->
                        </svg>
                    </div>

                    <div class="mb-4">
                        <div class="flex justify-between mb-2">
                            <span id="status-text" class="text-base font-medium text-gray-700">מתחיל...</span>
                            <span id="progress-percent" class="text-sm font-bold text-purple-600">0%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden shadow-inner">
                            <div id="progress-bar" class="bg-blue-600 h-3 rounded-full transition-all duration-500"
                                style="width: 0%"></div>
                        </div>
                        <div class="flex justify-between text-xs text-gray-500 mt-1">
                            <span>🔵 הורדה (0-40%)</span>
                            <span>🟣 המרה (40-60%)</span>
                            <span>🟢 תמלול (60-95%)</span>
                            <span>⭐ סיום (95-100%)</span>
                        </div>
                    </div>

                    <!-- Log Console -->
                    <div class="bg-gray-900 text-green-400 p-4 rounded-lg font-mono text-sm h-32 overflow-y-auto mb-6 shadow-lg"
                        id="log-console">
                        <div class="opacity-50">> המערכת מוכנה.</div>
                    </div>
                </div>

                <!-- Completion Section (Hidden by default) -->
                <div id="completion-section" class="hidden text-center animate-fade-in">
                    <!-- AI Summary Card -->
                    <div id="ai-summary-card"
                        class="hidden mb-6 bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl p-6 text-right">
                        <div class="reveal-target mb-3">
                            <h3 id="ai-title" class="text-2xl font-bold text-gray-900 mb-2"></h3>
                        </div>
                        <div class="reveal-target mb-3">
                            <div id="ai-tags" class="flex justify-end gap-2 flex-wrap"></div>
                        </div>
                        <div class="reveal-target">
                            <p id="ai-summary" class="text-gray-700 leading-relaxed"></p>
                        </div>
                    </div>

                    <div class="mb-6 reveal-target">
                        <div
                            class="mx-auto flex items-center justify-center h-20 w-20 rounded-full bg-green-100 mb-4 animate-pulse">
                            <svg class="h-12 w-12 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M5 13l4 4L19 7">
                                </path>
                            </svg>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-900">✅ התמלול הושלם בהצלחה!</h3>
                        <p class="text-gray-600 mt-2">הקובץ מוכן להורדה.</p>
                    </div>

                    <div class="flex flex-wrap gap-3 justify-center">
                        <button onclick="showPreview()" id="preview-btn"
                            class="inline-flex items-center bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-bold py-4 px-8 rounded-full shadow-lg transition duration-300 transform hover:-translate-y-1 hover:scale-105">
                            <svg class="w-6 h-6 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z">
                                </path>
                            </svg>
                            תצוגה מקדימה
                        </button>

                        <a href="#" id="player-link"
                            class="inline-flex items-center bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-bold py-4 px-8 rounded-full shadow-lg transition duration-300 transform hover:-translate-y-1 hover:scale-105">
                            <svg class="w-6 h-6 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z">
                                </path>
                            </svg>
                            צ'אט עם המורה (AI)
                        </a>

                        <a href="#" id="download-link"
                            class="inline-flex items-center bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700 text-white font-bold py-4 px-8 rounded-full shadow-lg transition duration-300 transform hover:-translate-y-1 hover:scale-105">
                            <svg class="w-6 h-6 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                            </svg>
                            הורד קובץ טקסט
                        </a>
                    </div>

                    <button onclick="resetUI()"
                        class="block w-full text-center text-gray-500 mt-6 hover:text-gray-700 text-sm underline transition">
                        תמלל הקלטה נוספת
                    </button>
                </div>

            </div>
        </div>

        <!-- History Panel -->
        <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
            <button onclick="toggleHistory()" id="history-toggle-btn"
                class="w-full p-4 text-right font-bold text-gray-700 hover:bg-gray-50 transition flex justify-between items-center">
                <span>📋 היסטוריית תמלולים</span>
                <span>הצג היסטוריה ▼</span>
            </button>

            <div id="history-panel" class="hidden border-t border-gray-200">
                <div id="history-list" class="p-4 space-y-2 max-h-96 overflow-y-auto">
                    <div class="text-gray-400 text-center py-4">טוען...</div>
                </div>
            </div>
        </div>

    </div>

    <!-- Preview Modal -->
    <div id="preview-modal"
        class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden animate-fade-in">
            <div class="gradient-bg p-6 text-white flex justify-between items-center">
                <h2 class="text-2xl font-bold">👁️ תצוגה מקדימה</h2>
                <button onclick="closePreview()"
                    class="text-white hover:text-gray-200 text-3xl font-bold">&times;</button>
            </div>
            <div class="p-6 overflow-y-auto max-h-[70vh]">
                <pre id="preview-text"
                    class="whitespace-pre-wrap text-right font-rubik leading-relaxed text-gray-800"></pre>
            </div>
            <div class="p-6 border-t border-gray-200 flex justify-end gap-3">
                <button onclick="closePreview()" class="px-6 py-2 bg-gray-200 hover:bg-gray-300 rounded-lg transition">
                    סגור
                </button>
                <a href="#" id="preview-download-link"
                    class="px-6 py-2 bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700 text-white rounded-lg transition">
                    הורד קובץ
                </a>
            </div>
        </div>
    </div>

    <!-- GSAP for SVGator-style animations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="/static/microinteractions.js"></script>
    <!-- Removed animation.js - heavy background animation not needed on upload page -->
    <script src="/static/script.js"></script>
</body>

</html>